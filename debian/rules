#!/usr/bin/make -f
# Copyright (c) Paul R. Tagliamonte, MIT/Expat, 2013


PYVERS  = $(shell pyversions -r)
DEBIAN_SETUP_PY_INSTALL_ARGS = install --skip-build --install-layout deb


%:
	dh $@ --with python2


override_dh_auto_clean:
	dh_auto_clean
	rm -rvf ./*.egg-info ./build


override_dh_auto_build:
	# This is a monster. It's much better than what was here before.
	#
	# Be thankful. It's a violation of sanity. I know. Just don't fuck
	# up the auto_install step.
	#
	#               -- PRT
	set -xe; \
	for py in $(PYVERS) $(PY3VERS); do \
		$$py setup.py build; \
		$$py setup.py $(DEBIAN_SETUP_PY_INSTALL_ARGS) \
			--root debian/python-debile; \
		$$py setup.py clean; \
		for setup in "master" "slave"; do \
			$$py setup.$$setup.py build; \
			$$py setup.$$setup.py $(DEBIAN_SETUP_PY_INSTALL_ARGS) \
				--root debian/python-debile-$$setup; \
			$$py setup.$$setup.py clean; \
		done; \
	done

override_dh_auto_install:
	# Remove me when dh_python2 can handle this file
	rm -vf debian/*/usr/lib/python*/*-packages/*.egg-info/SOURCES.txt
