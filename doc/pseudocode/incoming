

for each file in incoming:
    execute handler for file if file matches a glob


*.dud handler:
    if signature is bad:
        return reject

    if hashes suck:
        return reject

    look up source package by id
    if id sucks:
        return reject

    look up binary package by id
    if id sucks:
        return reject

    insert check record into the db

    for file in dud files:
        move file into /public/source_id/check_id

    load firehose data if it's there
        insert into database

    return accept


*.changes handler
    if signature is bad:
        return reject

    if hashes suck:
        return reject

    load group

    assure that teh acl is right

    if sourceful:
        if source/version exists in group:
            return reject

        insert source obj into the database
        invoke reprepro for the lucy group to includedsc
        insert jobs

    if binary:
        if source/version/arch exists in group:
            return reject

        insert binary obj into the database
        invoke reprepro for the lucy group to includedeb
        insert jobs

    return accept
